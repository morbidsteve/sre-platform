---
# Default deny-all AuthorizationPolicy for istiod control plane
# NIST AC-3, AC-4 â€” explicit allow required for control plane traffic
# NOTE: This is scoped to istiod only (not the gateway) because the
# gateway must accept external traffic and route it to upstream services.
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: deny-all-istiod
  namespace: istio-system
spec:
  selector:
    matchLabels:
      app: istiod

---
# Allow mesh workloads to reach istiod for xDS, CA, and webhook traffic
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: allow-istiod-control-plane
  namespace: istio-system
spec:
  selector:
    matchLabels:
      app: istiod
  action: ALLOW
  rules:
    - to:
        - operation:
            ports:
              - "15010"
              - "15012"
              - "15014"
              - "15017"

---
# Allow Prometheus to scrape Istio metrics
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: allow-prometheus-scrape
  namespace: istio-system
spec:
  action: ALLOW
  rules:
    - from:
        - source:
            namespaces:
              - monitoring
      to:
        - operation:
            ports:
              - "15014"
              - "15090"
